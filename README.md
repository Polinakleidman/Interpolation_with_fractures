# Интерполяция параметров скважин с учетом разломов земной коры
## Описание проблемы:
Известно, что многие параметры земной коры в различных точках (такие как глубина пластов, толщина, пористость, давление и т.д.) можно узнать, зная эти же параметры в каких-то определенных пробуренных скважинах, учитывая лишь расстояния до известных скважин. Основная проблема поиска таких параметров заключается в том, что такая зависимость пропадает, если путь до известной скважины проходит через разлом земной коры. Чтобы это исправить, нужно искать кратчайший путь, не проходящий через разломы. 

## Постановка задачи:
### Дается:
* прямоугольная сетка плоскости, в узлах которой нужно найти какой-то параметр(например нефтенасыщенность)
* описание разломов (наборы полигонов, которые представляют собой ломанные)
* координаты и параметры пробуренных скважин (они не обязательно находятся в узлах сетки)
### Вывод:
* значение параметров в каждом узле сетки

## Решение:
 *Замечание: Если считать, что сетка достаточно плотная, то можно вместо евклидового расстояния использовать манхэттенскую метрику или метрику Чебышева (в своем решении я использовала метрику Чебышева, (с манхэттенской метрикой количество ребер уменьшается примерно в 2 раза, далее будут поясняющие картинки, почему она не совсем хороша)*
* Для начала опишем граф обхода:
  * обозначим xleft, ybottom – координаты левого нижнего угла сетки
  * dx, dy - шаг сетки по оси x и по оси y	
  * nx,ny – количество узлов по х и по y (то есть всего узлов будет nx*ny, а ширина сетки=(nx – 1)*dx, длина=(ny – 1)*dy
  * Data – массив пробуренных скважин, count_data = их количество
  * Faults – разломы (то есть массив ломанных) </br>

Тогда в нашем графе **вершинами** будут узлы сетки и пробуренные скважины (их nx * ny + count_data) 
* Если вершина – известная скважина, то из нее максимум выходит 4 ребра в 4 узла, ее окружающие ( если через эту клетку проходит разлом, то в отсеченные вершины ребра не проводим)
* Если вершина – узел, то ребра до *скважин* в квадрате окрестностью [x -dx, d+dx] * [y -dy, d+dy] уже проведены, и мы проводим еще максимум 8 ребер до ближайших узлов (аналогично предыдущему случаю если эти ребра пересекаются с полигонами(частями разломов), то их мы не проводим.

  *Заметим что непосредственных ребер между двумя скважинами никогда не проводятся, но так и должно быть, потому что скважины в одной клетке можно просто усреднить и считать, что в каждой клетке максимум одна скважина)*

Теперь граф построен, на каждом **ребре** написан его вес (обычная длина), запустим тогда Дейкстру от каждой скважины

**После каждого запуска Дейкстры проверяем, существовал ли путь по прямой, не пересекающий разломы из каждого узла сетки в текующую обрабатываемую скважину.(если существовал, то в качестве минимального расстояния указываем его) Далее будет показано, почему это важно! назовем это обновление *ХОРОШИМ***

#### Посчитаем асимптотику: 
Построение графа работает за O(n+m) = (nx * ny+ count_data + 8 * (nx * ny+count_data) =O(nx * ny+count_data)
дейкстра  O(mlogn) = O(nlogn)
так как практически всегда nx * ny < 1000 * 1000, count_data < 1000, то итоговое время < O(10^9 * log(10^9)) ~ несколько минут

### Теперь перейдем к интерполяции.
*В качестве примера будем рассматривать параметр - глубина верхнего края нужного пласта*
* Рассмотрим построение изолиний по полученным глубинам в узлах сетки
* **Photo 1**
  ![Photo 1](https://github.com/Polinakleidman/Interpolation_with_fractures/blob/main/1.jpg "")
  * Первый график – как выглядела бы карта верхней границы пласта, если бы не было разломов (сами разломы отображены красным цветом) Видно, что все изолинии плавные, хотелось бы добиться, чтобы они сохраняли такое свойство и при учете разломов
  
  * Рассмотрим вторую картинку. Видно, что на верхнем графике все изолинии более *гладкие*, но при этом сами они ромбовидные, что противоречит законам природы, в то время как на нижнем графике очень много *зубчиков*, от короых очень хочется избавиться. Заметим, что отличаются они лишь тем, что код верхнего случая не содежит ***ХОРОШЕЕ*** обновление.
  * **Photo 2**
  ![Photo 2](https://github.com/Polinakleidman/Interpolation_with_fractures/blob/main/no_diag.jpg "") 
  
  * Рассмторим третью картинку. В ней все аналогично второй, только уже используется метрика Чебышева вместо манхэттенской, как мы видим, нижний график почти идеален: *зубчики* ушли, формы изолиний округлые, но остались *вибрирования*.
  * **Photo 2b**
  ![Photo 3](https://github.com/Polinakleidman/Interpolation_with_fractures/blob/main/diag.jpg "")
  * Предположение, как избавляться от вибрирования:
    
    В формуле:
    ```
      h = sqrt(dxn * dxn + dyn * dyn + asmoosnes * asmoosnes);
      ph = 1 / pow(h , power); 
    ``` 
      можно подгадывать значения *power* для выглаживания функций. 
